---
substitutions:
  name: irt01

#globals:
#  - id: harccode
#    initial_value: '0x2004'
#    type: int

esphome:
  name: ${name}

esp8266:
  board: esp8285


#This enables the receiver. The logs that come back mostly come from the receiver receiving from the transmitter
remote_receiver:
  pin:
    number: GPIO14
    inverted: true
  dump: all

#Not sure what the carrier duty is, but works!
remote_transmitter:
  pin:
    number: GPIO4
  carrier_duty_percent: 50%

#This is a helper so a random code can be put in (the number in HA is decimal, number below are hex. 
sensor:
  - platform: homeassistant
    id: Test_RC_Code
    entity_id: input_number.ac_rc_number
    #entity_id: input_text.ac_rc_code

button:
  - platform: template
    name: "Cabin AC On/Off"
    on_press:
      - remote_transmitter.transmit_pioneer: 
          rc_code_1: 0x2004
  - platform: template
    name: "Cabin AC Mode"
    on_press:
      - remote_transmitter.transmit_pioneer: 
          rc_code_1: 0x200D
  - platform: template
    name: "Cabin AC Up"
    on_press:
      - remote_transmitter.transmit_pioneer: 
          rc_code_1: 0x2005
  - platform: template
    name: "Cabin AC Down"
    on_press:
      - remote_transmitter.transmit_pioneer: 
          rc_code_1: 0x2001
  - platform: template
    name: "Cabin AC Speed"
    on_press:
      - remote_transmitter.transmit_pioneer: 
          rc_code_1: 0x2006
  - platform: template
    name: "Cabin AC Timer"
    on_press:
      - remote_transmitter.transmit_pioneer: 
          rc_code_1: 0x2000

  - platform: template
    name: "Cabin AC Code from HA"
    on_press:
      #- globals.set:
      #    id: harccode
      #    value: !lambda return int(id(Test_RC_Code).state);
      - remote_transmitter.transmit_pioneer: 
          #This took a while, rc_code needs a (hex?) integer, but number comes back as float hence int conversion
          #Running it on the id() without state was returning a huge number
          #To me it's not clear when the varius .state etc needed. But below example can put a 'variable' in any config.
          rc_code_1: !lambda return int(id(Test_RC_Code).state);
          #rc_code_1: !lambda |-
            #ESP_LOGD("lambda","sent %i to trans", id(harccode));
            #ESP_LOGD("lambda","got %i from sensor", id(Test_RC_Code));
            #return id(harccode);


#<<: !include include/pn_pac_default.yaml
<<: !include include/pw_pac_default.yaml
